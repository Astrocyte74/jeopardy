<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jeop2 - Best of Both</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Score Float Container -->
    <div id="scoreFloats"></div>

    <!-- Confetti Container -->
    <canvas id="confetti"></canvas>

    <!-- Screen Flash Overlay -->
    <div id="screenFlash"></div>

    <!-- Main Menu -->
    <div id="mainMenu" class="main-menu">
      <div class="menu-content-wrapper">

        <!-- LEFT SIDEBAR: Games -->
        <aside class="menu-sidebar">
          <div class="sidebar-header">
            <h2 class="sidebar-title">Games</h2>
            <div class="sidebar-actions">
              <button id="menuViewToggle" class="view-toggle-btn" title="Switch to grid view">‚ò∑</button>
              <button id="menuNewGameBtn" class="new-game-btn" title="Create new game">+ New Game</button>
            </div>
          </div>

          <div class="sidebar-search">
            <input type="text" id="menuGameSearch" placeholder="Search games..." autocomplete="off" />
            <span class="search-count" id="menuGameSearchCount">0</span>
          </div>

          <div class="sidebar-filter">
            <select id="menuCategorySelect">
              <option value="all">All Games</option>
            </select>
          </div>

          <div class="sidebar-games-list" id="menuGameList">
            <!-- Games will be populated by JS -->
          </div>
        </aside>

        <!-- RIGHT MAIN: Teams & Settings -->
        <main class="menu-main">
          <div class="main-header">
            <div class="header-left">
              <h1 class="menu-title">JEOPARDY</h1>
              <div class="menu-subtitle">Choose Your Game</div>
            </div>
            <!-- Selected game info will go here -->
          </div>

          <div class="main-scrollable">
            <!-- Selected Game Overview Card -->
            <div class="selected-game-card" id="selectedGameCard" style="display: none;">
              <div class="selected-game-header">
                <span class="selected-game-label">SELECTED</span>
              </div>
              <div class="selected-game-content">
                <h4 class="selected-game-title" id="selectedGameTitle">No game selected</h4>
                <p class="selected-game-subtitle" id="selectedGameSubtitle"></p>
                <div class="selected-game-meta">
                  <span class="selected-game-meta-item" id="selectedGameCategories"></span>
                  <span class="selected-game-meta-item" id="selectedGameQuestions"></span>
                </div>
              </div>
            </div>

            <!-- Teams Setup -->
            <div class="menu-section menu-section-teams">
              <div class="teams-header">
                <h3 class="section-title">üë• Teams</h3>
                <div class="teams-ai-buttons">
                  <button id="teamsGenerateAllBtn" class="teams-action-btn" title="Generate all team names">üé≤ AI Generate Names</button>
                  <button id="teamsEnhanceAllBtn" class="teams-action-btn sparkle" title="Enhance all team names">‚ú® Enhance</button>
                </div>
              </div>
              <div class="teams-setup" id="teamsSetup">
                <!-- Team inputs will be populated by JS -->
              </div>
              <button id="menuAddTeamBtn" class="btn btn-secondary btn-sm">+ Add Team</button>
            </div>

            <!-- Theme Selection (Collapsible by default) -->
            <div class="menu-section">
              <div class="collapsible-header collapsed" id="themeToggle">
                <h3 class="section-title">üé® Appearance</h3>
                <span class="collapsible-icon">‚ñ∏</span>
              </div>
              <div class="collapsible-content collapsed" id="themeContent">
                <div class="theme-grid" id="menuThemeGrid">
                  <!-- Themes will be populated by JS -->
                </div>
              </div>
            </div>

            <!-- Advanced Settings (Collapsible by default) -->
            <div class="menu-section">
              <div class="collapsible-header collapsed" id="advancedToggle">
                <h3 class="section-title">‚öôÔ∏è Advanced</h3>
                <span class="collapsible-icon">‚ñ∏</span>
              </div>
              <div class="collapsible-content collapsed" id="advancedContent">
                <div class="game-settings-fields">
                  <div class="field-display">
                    <div class="field-label">Game Title</div>
                    <div class="field-value-row">
                      <span id="menuGameTitleDisplay" class="field-value">Default</span>
                      <button id="menuGameTitleEditBtn" class="icon-btn-small" title="Edit title">‚úèÔ∏è</button>
                    </div>
                    <input id="menuGameTitle" type="text" placeholder="Custom title..." autocomplete="off" class="field-input-edit" style="display: none;" />
                  </div>
                  <div class="field-display">
                    <div class="field-label">Subtitle</div>
                    <div class="field-value-row">
                      <span id="menuGameSubtitleDisplay" class="field-value field-value-empty">No custom subtitle</span>
                      <button id="menuGameSubtitleEditBtn" class="icon-btn-small" title="Edit subtitle">‚úèÔ∏è</button>
                    </div>
                    <input id="menuGameSubtitle" type="text" placeholder="Custom subtitle..." autocomplete="off" class="field-input-edit" style="display: none;" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sticky Footer with Start Button -->
          <div class="menu-footer">
            <div class="start-status" id="startStatus">
              <span class="status-check">‚úì</span> Game selected
              <span class="status-check" id="teamsStatus">‚úì</span> <span id="teamsCount">2</span> teams
            </div>
            <div class="footer-buttons">
              <button id="resumeGameBtn" class="btn btn-secondary btn-medium" style="display: none;">‚Ü∫ Resume</button>
              <button id="startGameBtn" class="btn btn-primary btn-medium">‚ñ∂ Start Game</button>
            </div>
          </div>
        </main>

      </div>

      <!-- Create Game Button (hidden, triggered by menuNewGameBtn) -->
      <button id="createGameBtn" style="display: none;"></button>
    </div>

    <!-- Game Container (hidden initially) -->
    <div id="gameContainer" class="game-container hidden">
      <header class="topbar">
        <div class="titleblock">
          <h1 id="gameTitle">Jeop2</h1>
          <p id="gameSubtitle" class="subtitle"></p>
        </div>

        <div class="topbarActions">
          <div class="menu-dropdown" id="topMenuDropdown">
            <button id="topMenuBtn" class="btn btnSecondary" type="button" title="Menu">‚ò∞</button>
            <div class="menu-dropdown-content">
              <button class="menu-dropdown-item" data-action="settings">‚öôÔ∏è Game Settings</button>
              <button class="menu-dropdown-item menu-dropdown-danger" data-action="reset">üîÑ Reset Game</button>
              <div class="menu-dropdown-divider"></div>
              <div class="theme-section">
                <div class="theme-section-label">Theme</div>
                <div class="theme-circles" id="themeCircles"></div>
              </div>
              <div class="menu-dropdown-divider"></div>
              <button class="menu-dropdown-item" data-action="mainmenu">üè† Main Menu</button>
            </div>
          </div>
        </div>
      </header>

      <main class="layout">
        <section class="scores" aria-label="Scores">
          <div class="scoresHeader">
            <h2>Scores</h2>
            <div class="activeTeamHint">Select who's answering.</div>
          </div>
          <div id="teams"></div>
        </section>

        <section class="boardWrap" aria-label="Game board">
          <div id="board" class="board" role="grid" aria-label="Jeopardy board"></div>
        </section>
      </main>
    </div>

    <!-- Clue Dialog (LARGE) -->
    <dialog id="clueDialog" class="dialog clue-dialog-large">
      <form method="dialog" class="dialogCard dialogCardLarge">
        <button class="closeBtnTop" value="close" aria-label="Close" type="submit">‚úï</button>

        <div class="clueDialogHeader">
          <div id="clueCategory" class="dialogCategory"></div>
          <div id="clueValue" class="dialogValue"></div>
        </div>

        <div class="clueContent">
          <div id="clueText" class="dialogClue dialogClueLarge"></div>
          <div id="responseText" class="dialogResponse dialogResponseLarge hidden"></div>
        </div>

        <button id="showResponseBtn" class="btn btnSecondary btn-large revealBtn" type="button">Show Answer</button>

        <div class="scoringPanel">
          <div class="scoringPanelHeader">
            <div class="whoAnsweredLabel">Who answered?</div>
          </div>
          <div id="answeringTeams" class="answeringTeams" role="group" aria-label="Who answered?"></div>
          <div class="scoringActions">
            <button id="markIncorrectBtn" class="btn btnDanger btn-large" type="button">‚úó Incorrect</button>
            <button id="markCorrectBtn" class="btn btnPrimary btn-large" type="button">‚úì Correct</button>
          </div>
        </div>
      </form>
    </dialog>

    <!-- Settings Dialog -->
    <dialog id="settingsDialog" class="dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">Settings</div>
          </div>
          <button class="iconBtn" value="close" aria-label="Close" type="submit">‚úï</button>
        </div>

        <div class="settingsGrid">
          <label class="field">
            <div class="label">Game title</div>
            <input id="settingsGameTitle" type="text" autocomplete="off" />
          </label>

          <label class="field">
            <div class="label">Subtitle</div>
            <input id="settingsGameSubtitle" type="text" autocomplete="off" />
          </label>

          <div class="field">
            <div class="label">Teams</div>
            <div id="settingsTeams"></div>
            <button id="addTeamBtn" class="btn btnSecondary" type="button">Add team</button>
          </div>
        </div>

        <div class="dialogActions">
          <button id="saveSettingsBtn" class="btn btnPrimary" value="close" type="submit">
            Save
          </button>
        </div>
      </form>
    </dialog>

    <!-- Games Dialog -->
    <dialog id="gamesDialog" class="dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">Choose a Game</div>
          </div>
          <button class="iconBtn" value="close" aria-label="Close" type="submit">‚úï</button>
        </div>

        <div class="gamesGrid">
          <div class="gamesListWrap">
            <div id="gamesList" class="gamesList" role="list"></div>
          </div>

          <div class="gamesSide">
            <div class="gamesHelp">
              <div class="gamesHelpTitle">Add games</div>
              <div id="gamesHelpText" class="gamesHelpText">
                Add entries to <code>games/index.json</code> to show more built-in games, or upload a JSON file.
              </div>
            </div>

            <label class="btn btnSecondary fileBtn">
              Load JSON file
              <input id="gamesFileInput" type="file" accept=".json,application/json" />
            </label>

            <button id="removeCustomGameBtn" class="btn btnDanger" type="button" disabled>
              Remove selected custom game
            </button>
          </div>
        </div>

        <div class="dialogActions">
          <button id="playSelectedGameBtn" class="btn btnPrimary" value="close" type="submit" disabled>
            Play selected
          </button>
        </div>
      </form>
    </dialog>

    <!-- Theme Dialog -->
    <dialog id="themeDialog" class="dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">Choose Theme</div>
          </div>
          <button class="iconBtn" value="close" aria-label="Close" type="submit">‚úï</button>
        </div>

        <div id="themeGrid" class="themeGrid"></div>

        <div class="dialogActions">
          <button class="btn btnPrimary" value="close" type="submit">Done</button>
        </div>
      </form>
    </dialog>

    <!-- Resume Dialog -->
    <dialog id="resumeDialog" class="dialog resume-dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">Welcome Back!</div>
          </div>
        </div>

        <div class="resume-content">
          <div class="resume-icon">üèÜ</div>
          <div class="resume-title">Resume your game?</div>
          <div class="resume-subtitle" id="resumeGameTitle">Loading...</div>
        </div>

        <div class="dialogActions">
          <button id="newGameBtn" class="btn btnSecondary btn-large" type="button" value="close">Main Menu</button>
          <button id="resumeGameBtn" class="btn btnPrimary btn-large" type="button">‚ñ∂ Resume</button>
        </div>
      </form>
    </dialog>

    <!-- Reset Confirmation Dialog -->
    <dialog id="resetDialog" class="dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">Reset Game</div>
          </div>
          <button class="iconBtn" value="close" aria-label="Close" type="submit">‚úï</button>
        </div>

        <div class="reset-content">
          <div class="reset-icon">‚ö†Ô∏è</div>
          <div class="reset-title">Are you sure?</div>
          <div class="reset-subtitle">This will clear all scores and progress. This action cannot be undone.</div>
        </div>

        <div class="dialogActions">
          <button id="cancelResetBtn" class="btn btnSecondary btn-large" type="button" value="close">Cancel</button>
          <button id="confirmResetBtn" class="btn btnDanger btn-large" type="button">Yes, Reset Game</button>
        </div>
      </form>
    </dialog>

    <!-- Delete Category Confirmation Dialog -->
    <dialog id="deleteCategoryDialog" class="dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">Delete Category</div>
          </div>
          <button class="iconBtn" value="close" aria-label="Close" type="submit">‚úï</button>
        </div>

        <div class="reset-content">
          <div class="reset-icon">üóëÔ∏è</div>
          <div class="reset-title">Delete category?</div>
          <div class="reset-subtitle" id="deleteCategoryMessage">Games in this category will move to "All Games".</div>
        </div>

        <div class="dialogActions">
          <button id="cancelDeleteCategoryBtn" class="btn btnSecondary btn-large" type="button" value="close">Cancel</button>
          <button id="confirmDeleteCategoryBtn" class="btn btnDanger btn-large" type="button">Delete</button>
        </div>
      </form>
    </dialog>

    <!-- Game Creator Modal -->
    <dialog id="gameCreatorDialog" class="dialog game-creator-dialog">
      <form method="dialog" class="dialogCard">
        <div class="dialogHeader">
          <div class="dialogMeta">
            <div class="dialogCategory">üéÆ Game Creator</div>
          </div>
          <button class="iconBtn" value="close" aria-label="Close" type="submit">‚úï</button>
        </div>

        <div class="game-creator-workspace">
          <!-- Left Sidebar -->
          <aside class="creator-sidebar">
            <!-- Categories Section -->
            <div class="sidebar-section">
              <div class="sidebar-header">
                <span class="sidebar-title">Categories</span>
                <button class="sidebar-add-btn" id="creatorAddCategoryBtn" title="Add Category" type="button">+</button>
              </div>
              <div class="sidebar-list" id="creatorCategoriesList">
                <!-- Categories will be populated by JS -->
              </div>
            </div>

            <!-- Games Section -->
            <div class="sidebar-section">
              <div class="sidebar-header">
                <span class="sidebar-title">Games</span>
              </div>
              <div class="sidebar-filter">
                <select id="creatorCategoryFilter" class="sidebar-filter-select">
                  <option value="all">Filter: All</option>
                </select>
              </div>
              <div class="sidebar-search">
                <input type="text" id="creatorSearchInput" placeholder="Search..." autocomplete="off" />
                <span class="search-count" id="creatorSearchCount">0</span>
              </div>
              <div class="sidebar-list sidebar-games-list" id="creatorGamesList">
                <!-- Games will be populated by JS -->
              </div>
            </div>
          </aside>

          <!-- Main Canvas - 3 Column Layout -->
          <main class="creator-main">
            <!-- Game Header Area (full width) -->
            <div class="creator-game-header" id="creatorGameHeader">
              <div class="creator-empty-state">
                <div class="creator-empty-icon">üéÆ</div>
                <div class="creator-empty-title">Select a game to edit</div>
                <div class="creator-empty-text">Choose a category and game from the sidebar</div>
              </div>
            </div>

            <!-- 3-Column Workspace: Categories | Clues | Editor -->
            <div class="creator-workspace-grid" id="creatorWorkspaceGrid" style="display: none;">
              <!-- Categories Column -->
              <section class="creator-column creator-categories-column">
                <div class="column-header">
                  <div class="column-header-left">
                    <h3 class="column-title">Categories</h3>
                  </div>
                  <div class="column-header-right">
                    <div class="categories-count-control">
                      <button class="count-control-btn" id="categoriesDecreaseBtn" type="button" title="Decrease">‚àí</button>
                      <span class="count-control-value" id="categoriesCountValue">6</span>
                      <button class="count-control-btn" id="categoriesIncreaseBtn" type="button" title="Increase">+</button>
                    </div>
                    <button class="column-add-btn" id="workspaceAddCategoryBtn" type="button" title="Add Category">+</button>
                    <div class="column-ai-menu-placeholder"></div>
                  </div>
                </div>
                <div class="column-list" id="workspaceCategoriesList">
                  <!-- Categories injected by JS -->
                </div>
              </section>

              <!-- Questions Column -->
              <section class="creator-column creator-clues-column">
                <div class="column-header">
                  <div class="column-header-left">
                    <h3 class="column-title">Questions</h3>
                    <span class="column-meta" id="cluesColumnMeta"></span>
                  </div>
                  <div class="column-header-right">
                    <div class="questions-count-control">
                      <button class="count-control-btn" id="questionsDecreaseBtn" type="button" title="Decrease">‚àí</button>
                      <span class="count-control-value" id="questionsCountValue">5</span>
                      <button class="count-control-btn" id="questionsIncreaseBtn" type="button" title="Increase">+</button>
                    </div>
                    <button class="column-add-btn" id="workspaceAddQuestionBtn" type="button" title="Add Question">+</button>
                    <div class="column-ai-menu-placeholder"></div>
                  </div>
                </div>
                <div class="column-list" id="workspaceCluesList">
                  <!-- Questions injected by JS -->
                </div>
              </section>

              <!-- Answers Column (Always Visible) -->
              <section class="creator-column creator-editor-column">
                <div class="column-header">
                  <h3 class="column-title">Answers</h3>
                </div>
                <div class="editor-panel" id="workspaceEditorPanel">
                  <div class="editor-empty-state">
                    <div class="editor-empty-icon">‚úèÔ∏è</div>
                    <div class="editor-empty-text">Select a question to edit</div>
                  </div>
                </div>
              </section>
            </div>

            <!-- Sticky Action Bar -->
            <div class="creator-action-bar">
              <span class="action-bar-save" id="creatorSaveIndicator" style="opacity: 0.5;">All changes saved automatically</span>
            </div>
          </main>
        </div>

        <input type="file" id="creatorImportInput" accept=".json,application/json" style="display: none;" />

        <!-- Simple Input Modal (inside game creator dialog to appear above modal) -->
        <div id="inputDialog" class="input-dialog-overlay" style="display: none;">
          <div class="input-dialog-card">
            <button class="input-dialog-close" id="inputDialogXBtn" aria-label="Cancel" type="button">‚úï</button>

            <h2 class="input-dialog-title" id="inputDialogTitle">Create a new game</h2>

            <p class="input-dialog-helper" id="inputDialogHelper">Enter a theme to get started, or leave blank for a random theme</p>

            <div class="input-dialog-field">
              <input id="inputDialogValue" type="text" placeholder='e.g. "The Life of Jesus", "World Geography", "Movie Quotes"' autocomplete="off" autofocus />
              <div id="inputDialogError" class="input-dialog-error"></div>
            </div>

            <div class="input-dialog-actions">
              <button id="inputDialogCancel" class="btn btnSecondary" type="button">Cancel</button>
              <button id="inputDialogConfirm" class="btn btnPrimary" type="button">Create game</button>
            </div>
          </div>
        </div>

        <!-- Category Edit Dialog (for editing display name and content topic) -->
        <div id="categoryEditDialog" class="input-dialog-overlay" style="display: none;">
          <div class="input-dialog-card">
            <button class="input-dialog-close" id="categoryEditDialogXBtn" aria-label="Cancel" type="button">‚úï</button>

            <h2 class="input-dialog-title" id="categoryEditDialogTitle">Edit Category</h2>

            <p class="input-dialog-helper" id="categoryEditDialogHelper">Update the category name and topic</p>

            <div class="input-dialog-field">
              <label for="categoryEditTitleInput" class="input-dialog-label">Display Name</label>
              <input id="categoryEditTitleInput" type="text" placeholder='e.g. "Bedrock Banter"' autocomplete="off" autofocus />
              <div class="input-dialog-hint">What players see on the game board</div>
            </div>

            <div class="input-dialog-field">
              <label for="categoryEditTopicInput" class="input-dialog-label">Content Topic</label>
              <input id="categoryEditTopicInput" type="text" placeholder='e.g. "Flintstones Trivia"' autocomplete="off" />
              <div class="input-dialog-hint">What questions are actually about (for AI)</div>
            </div>

            <div class="input-dialog-actions">
              <button id="categoryEditDialogCancel" class="btn btnSecondary" type="button">Cancel</button>
              <button id="categoryEditDialogConfirm" class="btn btnPrimary" type="button">Save</button>
            </div>
          </div>
        </div>

        <!-- Selection Dialog (for radio/tile choices like difficulty) -->
        <div id="selectionDialog" class="input-dialog-overlay" style="display: none;">
          <div class="input-dialog-card">
            <button class="input-dialog-close" id="selectionDialogXBtn" aria-label="Cancel" type="button">‚úï</button>

            <h2 class="input-dialog-title" id="selectionDialogTitle">Choose an option</h2>

            <p class="input-dialog-helper" id="selectionDialogHelper">Select your preference below</p>

            <div class="selection-dialog-options" id="selectionDialogOptions">
              <!-- Options will be injected by JS -->
            </div>

            <div class="input-dialog-actions">
              <button id="selectionDialogBack" class="btn btnSecondary" type="button">Back</button>
              <button id="selectionDialogConfirm" class="btn btnPrimary" type="button">Continue</button>
            </div>
          </div>
        </div>

        <!-- Loading Dialog (shows during AI generation) -->
        <div id="loadingDialog" class="input-dialog-overlay" style="display: none;">
          <div class="loading-dialog-card">
            <div class="loading-spinner"></div>
            <h2 class="loading-dialog-title" id="loadingDialogTitle">Creating your game...</h2>
            <p class="loading-dialog-status" id="loadingDialogStatus">Connecting to AI...</p>
          </div>
        </div>
      </form>
    </dialog>

    <!-- AI Integration Scripts (must load before app.js) -->
    <script src="ai-prompts.js"></script>
    <script src="ai-service-frontend.js"></script>
    <script src="ai-toast.js"></script>
    <script src="ai-preview.js"></script>
    <script src="ai-actions.js"></script>
    <script src="ai-buttons.js"></script>
    <!-- Game Creator Modules -->
    <script src="game-creator/game-creator-storage.js"></script>
    <script src="game-creator/game-creator-utils.js"></script>
    <script src="game-creator/game-creator-state.js"></script>
    <script src="game-creator/game-creator-editor.js"></script>
    <script src="game-creator/game-creator-ui.js"></script>
    <script src="game-creator/game-creator-main.js"></script>
    <script src="app.js"></script>
  </body>
</html>
